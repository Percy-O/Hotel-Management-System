{% extends user.can_manage_bookings|yesno:"dashboard_base.html,guest_dashboard_base.html" %}

{% block header_title %}Entry Pass{% endblock %}
{% block header_subtitle %}Scan for entry and verification{% endblock %}

{% block header_actions %}
<a href="{% url 'download_barcode' booking.pk %}" class="flex items-center gap-2 px-4 py-2 bg-primary text-slate-900 rounded-lg text-sm font-bold hover:bg-primary-hover transition-colors shadow-lg shadow-primary/20">
    <span class="material-symbols-outlined text-[18px]">download</span>
    Download
</a>
{% endblock %}

{% block dashboard_content %}
<div class="max-w-md mx-auto py-8">
    <div class="bg-white rounded-3xl shadow-2xl overflow-hidden relative">
        <!-- Top Section -->
        <div class="bg-primary p-6 text-center relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-full opacity-10" style="background-image: repeating-linear-gradient(45deg, #000 0, #000 10px, transparent 10px, transparent 20px);"></div>
            <div class="relative z-10">
                <div class="size-12 bg-white rounded-xl flex items-center justify-center mx-auto mb-3 shadow-lg overflow-hidden">
                    {% if site_settings.hotel_logo %}
                        <img src="{{ site_settings.hotel_logo.url }}" alt="{{ site_settings.hotel_name }}" class="w-full h-full object-cover">
                    {% else %}
                        <span class="material-symbols-outlined text-primary text-2xl">hotel</span>
                    {% endif %}
                </div>
                <h2 class="text-xl font-black text-slate-900 uppercase tracking-widest">{{ site_settings.hotel_name }}</h2>
                <p class="text-xs font-bold text-slate-900/70 uppercase tracking-wider">Entry Pass</p>
            </div>
        </div>

        <!-- Ticket Body -->
        <div class="p-8">
            <div class="text-center mb-8">
                <p class="text-xs text-gray-400 uppercase tracking-wider mb-1">Guest Name</p>
                <h3 class="text-2xl font-bold text-gray-900">{{ booking.guest_name }}</h3>
            </div>

            <div class="grid grid-cols-2 gap-6 mb-8 text-center">
                <div class="bg-gray-50 p-3 rounded-xl border border-gray-100">
                    <p class="text-[10px] text-gray-400 uppercase font-bold mb-1">Room Number</p>
                    <p class="text-xl font-black text-primary">{{ booking.room.room_number }}</p>
                </div>
                <div class="bg-gray-50 p-3 rounded-xl border border-gray-100">
                    <p class="text-[10px] text-gray-400 uppercase font-bold mb-1">Type</p>
                    <p class="text-sm font-bold text-gray-700 truncate">{{ booking.room.room_type.name }}</p>
                </div>
            </div>

            <div class="flex justify-between text-sm mb-8 px-4">
                <div class="text-left">
                    <p class="text-xs text-gray-400">Check In</p>
                    <p class="font-bold text-gray-800">{{ booking.check_in_date|date:"M d, Y" }}</p>
                    <p class="text-xs text-gray-500">{{ booking.check_in_date|date:"H:i" }}</p>
                </div>
                <div class="text-right">
                    <p class="text-xs text-gray-400">Check Out</p>
                    <p class="font-bold text-gray-800">{{ booking.check_out_date|date:"M d, Y" }}</p>
                    <p class="text-xs text-gray-500">{{ booking.check_out_date|date:"H:i" }}</p>
                </div>
            </div>

            <!-- QR Code Area -->
            <div class="border-t-2 border-dashed border-gray-200 pt-8 text-center">
                {% if barcode_base64 %}
                    <img src="data:image/png;base64,{{ barcode_base64 }}" alt="Booking QR Code" class="size-48 mx-auto object-contain mix-blend-multiply mb-4">
                    <p class="font-mono text-sm tracking-[0.2em] text-gray-500">{{ booking.booking_id }}</p>
                {% else %}
                    <p class="text-red-500 text-sm">QR Code Unavailable</p>
                {% endif %}
            </div>
        </div>

        <!-- Cutout Circles -->
        <div class="absolute top-[168px] -left-4 size-8 bg-background-dark rounded-full"></div>
        <div class="absolute top-[168px] -right-4 size-8 bg-background-dark rounded-full"></div>
    </div>
    
    <div class="text-center mt-6">
        <a href="{% url 'booking_detail' booking.pk %}" class="text-sm text-text-secondary-dark hover:text-text-main transition-colors">Back to Details</a>
    </div>
</div>
{% endblock %}
