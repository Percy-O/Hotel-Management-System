{% extends 'base_public.html' %}
{% load widget_tweaks %}

{% block title %}Login - IHotel{% endblock %}

{% block content %}

{% if not request.tenant or request.tenant.schema_name == 'public' %}
    <!-- Public/SaaS Login View -->
    {% block navbar %}
    {% include 'includes/saas_navbar.html' %}
    {% endblock %}

    <div class="min-h-screen flex items-center justify-center bg-[#020617] py-24 px-4 sm:px-6 lg:px-8 relative overflow-hidden">
        <!-- Glow Effects -->
        <div class="absolute top-0 left-1/2 -translate-x-1/2 w-full h-[500px] max-w-7xl pointer-events-none">
            <div class="absolute top-[-100px] left-1/2 -translate-x-1/2 w-[800px] h-[500px] bg-blue-600/10 rounded-[100%] blur-[100px] opacity-50"></div>
        </div>

        <div class="max-w-md w-full bg-[#0f172a] p-8 rounded-2xl border border-white/10 shadow-2xl relative z-10">
            <div class="text-center mb-8">
                <div class="size-12 rounded-lg bg-blue-600 flex items-center justify-center mx-auto mb-4 shadow-lg shadow-blue-600/20">
                    <span class="material-symbols-outlined text-white text-2xl">domain</span>
                </div>
                <h2 class="text-3xl font-bold text-white tracking-tight">
                    Welcome Back
                </h2>
                <p class="mt-2 text-sm text-gray-400">
                    Sign in to manage your hotels
                </p>
            </div>

            <form class="space-y-6" method="POST">
                {% csrf_token %}
                
                {% if form.non_field_errors %}
                <div class="rounded-xl bg-red-500/10 p-4 border border-red-500/20 mb-4">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <span class="material-symbols-outlined text-red-400">error</span>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-sm font-medium text-red-400">Login Failed</h3>
                            <div class="mt-1 text-sm text-red-300">
                                {{ form.non_field_errors }}
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}

                <div class="space-y-4">
                    {% for field in form %}
                    <div>
                        <label for="{{ field.id_for_label }}" class="block text-sm font-medium text-gray-300 mb-1.5">{{ field.label }}</label>
                        {{ field|add_class:"appearance-none rounded-xl relative block w-full px-4 py-3 border border-white/10 bg-[#1e293b]/50 placeholder-gray-500 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all sm:text-sm" }}
                        {% if field.errors %}
                            <p class="text-red-400 text-xs mt-1">{{ field.errors.0 }}</p>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>

                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <input id="remember-me" name="remember-me" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-600 rounded bg-[#1e293b]">
                        <label for="remember-me" class="ml-2 block text-sm text-gray-400">
                            Remember me
                        </label>
                    </div>

                    <div class="text-sm">
                        <a href="#" class="font-medium text-blue-500 hover:text-blue-400">
                            Forgot password?
                        </a>
                    </div>
                </div>

                <button type="submit" class="w-full flex justify-center py-3 px-4 border border-transparent text-sm font-bold rounded-xl text-white bg-blue-600 hover:bg-blue-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all shadow-lg shadow-blue-600/25">
                    Sign in
                </button>
                
                <div class="text-center mt-6">
                    <p class="text-sm text-gray-400">
                        Don't have an account? 
                        <a href="{% url 'create_tenant' %}" class="font-medium text-blue-500 hover:text-blue-400">
                            Get Started
                        </a>
                    </p>
                </div>
            </form>
        </div>
    </div>

    {% block footer %}
    {% include 'includes/saas_footer.html' %}
    {% endblock %}

{% else %}
    <!-- Tenant Login View (Customized) -->
    <div class="min-h-screen flex items-center justify-center bg-dark-900 py-12 px-4 sm:px-6 lg:px-8 relative overflow-hidden">
        <!-- Tenant Background Pattern/Image -->
        <div class="absolute inset-0 z-0">
             {% if request.tenant.background_image %}
                <img src="{{ request.tenant.background_image.url }}" class="w-full h-full object-cover opacity-20 blur-sm">
             {% else %}
                <div class="absolute inset-0 bg-gradient-to-br from-gold-500/5 to-transparent"></div>
             {% endif %}
        </div>

        <div class="max-w-md w-full bg-dark-800 p-8 rounded-2xl border border-white/10 shadow-2xl relative z-10 backdrop-blur-md">
            <div class="text-center mb-8">
                {% if request.tenant.logo %}
                    <img src="{{ request.tenant.logo.url }}" alt="{{ request.tenant.name }}" class="h-16 mx-auto mb-4 object-contain">
                {% else %}
                    <div class="size-16 rounded-full bg-gold-500 flex items-center justify-center text-slate-900 mx-auto mb-4 text-2xl font-bold">
                        {{ request.tenant.name|slice:":1" }}
                    </div>
                {% endif %}
                
                <h2 class="text-3xl font-extrabold text-white">
                    Welcome to {{ request.tenant.name }}
                </h2>
                <p class="mt-2 text-sm text-gray-400">
                    Guest & Staff Portal
                </p>
            </div>

            <form class="space-y-6" method="POST">
                {% csrf_token %}
                
                {% if form.non_field_errors %}
                <div class="rounded-md bg-red-500/10 p-4 border border-red-500/20 mb-4">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <span class="material-symbols-outlined text-red-400">error</span>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-sm font-medium text-red-400">Login Failed</h3>
                            <div class="mt-2 text-sm text-red-300">
                                {{ form.non_field_errors }}
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}

                <div class="mb-4 text-center p-3 bg-gold-500/5 rounded-lg border border-gold-500/10">
                    <p class="text-xs text-gray-400">
                        <span class="font-bold text-gold-500">Guests:</span> Use your Email as username and First Name as password.
                    </p>
                </div>

                <div class="space-y-4">
                    {% for field in form %}
                    <div>
                        <label for="{{ field.id_for_label }}" class="block text-sm font-medium text-gray-400 mb-1">{{ field.label }}</label>
                        {{ field|add_class:"appearance-none rounded-lg relative block w-full px-4 py-3 border border-white/10 bg-dark-900 placeholder-gray-500 text-white focus:outline-none focus:ring-1 focus:ring-gold-500 focus:border-gold-500 sm:text-sm transition-all" }}
                        {% if field.errors %}
                            <p class="text-red-400 text-xs mt-1">{{ field.errors.0 }}</p>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>

                <div>
                    <button type="submit" class="group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-bold rounded-lg text-slate-900 bg-gold-500 hover:bg-gold-400 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gold-500 transition-all shadow-lg shadow-gold-500/20">
                        Sign in
                    </button>
                </div>
                
                <div class="text-center mt-4">
                    <p class="text-sm text-gray-400">
                        Don't have an account? 
                        <a href="{% url 'register' %}" class="font-medium text-gold-500 hover:text-white transition-colors">
                            Register here
                        </a>
                    </p>
                </div>
            </form>
        </div>
    </div>
{% endif %}

{% endblock %}